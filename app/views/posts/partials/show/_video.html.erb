<%= content_tag(:video, nil, id: 'image', class: post.display_class_for(CurrentUser.user) ,:loop => "true", :controls => "controls", poster: post.is_ugoira? ? nil : post.large_file_url) do %>
  <% if post.is_ugoira? %>
    <%= content_tag(:source, nil, src: post.large_file_url, type: 'video/webm') %>
  <% else %>
    <%= content_tag(:source, nil, src: post.file_url_ext_for(CurrentUser.user, 'webm'), type: 'video/webm') %>
    <%= content_tag(:source, nil, src: post.file_url_ext_for(CurrentUser.user, 'mp4'), type: 'video/mp4') %>
  <% end %>
<% end %>

<%= javascript_tag nonce: true do -%>
  (function () {
    var videoEl = document.getElementById('image');
    var savedVolume = parseFloat(localStorage.getItem('video_volume') || '1.0');
    if (videoEl) {
      videoEl.volume = savedVolume;
      videoEl.addEventListener('volumechange', function (evt) {
      if (evt.target) {
        localStorage.setItem('video_volume', evt.target.volume);
      }
    });
  }
  })();
<% end -%>
